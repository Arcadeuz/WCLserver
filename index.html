<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Web Socket Demo</title>
  </head>
  <body>
    <p id="server-time"></p>
    <form>
      <textarea rows="8" cols="80" id="message"></textarea>
      <br />
      <button type="submit">Send</button>
    </form>
      <button  onclick="ws2.send('ClienteMensaje');">OTROSEND</button>
    <ul id="chat"></ul>
    
    <script>
        let HOST = location.origin.replace(/^http/, 'ws')
        let ws = new WebSocket(HOST);
        let ws2;
        let el;
      //  const connection = new WebSocket(HOST);
          
        ws.onmessage = (event) => {


        };


        ws.onopen = () => {
          console.log('connected');
          ws.send("YARE YARE YARE");
        };

        ws.onclose = () => {
          console.error('disconnected');
        };

        ws.onerror = error => {
          console.error('failed to connect', error);
        };

        ws.onmessage = event => {
          //console.log('received', event.data);
            eventArr = event.data.split(">");
            //console.log(event.data + " -> " + eventArr[0] + " / " + eventArr[1]);
            if (eventArr[0] == "PORT"){
              ws = new WebSocket(HOST+":"+eventArr[1]);
            }
          
          
          
          let li = document.createElement('li');
          li.innerText = event.data;
          document.querySelector('#chat').append(li);
        };
      


        document.querySelector('form').addEventListener('submit', event => {
          event.preventDefault();
          let message = document.querySelector('#message').value;
          ws.send(message);
          document.querySelector('#message').value = '';
        });    
    </script>
  </body>
</html>


<!--
<html>
  <head>
    <script>
      let HOST = location.origin.replace(/^http/, 'ws')
      let ws = new WebSocket(HOST);
      let el;

      ws.onmessage = (event) => {
        el = document.getElementById('server-time');
        el.innerHTML = 'Server time: ' + event.data;
      };
    </script>
  </head>
  <body>
    <p id="server-time"></p>
  </body>
</html>
-->
